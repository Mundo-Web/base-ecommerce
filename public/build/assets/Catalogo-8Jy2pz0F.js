import{R as r,r as o}from"./FilterContainer-TykbAVkI.js";import{C as N,c as S}from"./CreateReactScript-qyXjqq-l.js";import{F as R,P as j,a as O}from"./ProductCard-3IWKSsu6.js";import{m as T}from"./main-jzs2GwAM.js";import{a as J}from"./arrayJoin-Fk5sgFcM.js";import"./_commonjsHelpers-4gQjN7DL.js";import"./index-GBzf7Cls.js";import"./CreateReactScript-JKK_oT5p.js";import"./axios-_sX4vCAy.js";import"./ProductCard-ssICDoe4.js";const M=({minPrice:m,maxPrice:d,categories:y,tags:P,attribute_values:E,id_cat:p,tag_id:f,subCatId:g})=>{const[F,k]=o.useState([]),[e,h]=o.useState(p?{category_id:[p]}:{"txp.tag_id":[f]}),[u,v]=o.useState(0),[c,x]=o.useState(1);o.useEffect(()=>{g!==null&&h({...e,subcategory_id:[g]})},[]),o.useEffect(()=>{x(1),b()},[e]),o.useEffect(()=>{b()},[c]);const b=async()=>{const t=[];if((e.maxPrice||e.minPrice)&&(e.maxPrice&&e.minPrice?t.push([[["precio",">=",e.minPrice],"or",["descuento",">=",e.minPrice]],"and",[["precio","<=",e.maxPrice],"or",["descuento","<=",e.maxPrice]]]):e.minPrice?t.push([["precio",">=",e.minPrice],"or",["descuento",">=",e.minPrice]]):e.maxPrice&&t.push([["precio","<=",e.maxPrice],"or",["descuento","<=",e.maxPrice]])),e["txp.tag_id"]&&e["txp.tag_id"].length>0){const i=[];e["txp.tag_id"].forEach((a,s)=>{s==0?i.push(["txp.tag_id","=",a]):i.push("or",["txp.tag_id","=",a])}),t.push(i)}for(const i in e){if(!i.startsWith("attribute-")||e[i].length==0)continue;const[,a]=i.split("-"),s=[];e[i].forEach((_,C)=>{C==0?s.push(["apv.attribute_value_id","=",_]):s.push("or",["apv.attribute_value_id","=",_])}),t.push([["a.id","=",a],"and",s])}if(e.category_id&&e.category_id.length>0){const i=[];e.category_id.forEach((a,s)=>{s==0?i.push(["categoria_id","=",a]):i.push("or",["categoria_id","=",a])}),t.push(i)}if(e.subcategory_id&&e.subcategory_id.length>0){const i=[];e.subcategory_id.forEach((a,s)=>{s==0?i.push(["subcategory_id","=",a]):i.push("or",["subcategory_id","=",a])}),t.push(i)}const{status:n,result:l}=await T.Fetch("/api/products/paginate",{method:"POST",body:JSON.stringify({requireTotalCount:!0,filter:J([...t,["products.visible","=",!0]],"and"),take:12,skip:12*(c-1)})});k((l==null?void 0:l.data)??[]),v((l==null?void 0:l.totalCount)??0)},w=E.reduce((t,n)=>(t[n.attribute_id]||(t[n.attribute_id]=[]),t[n.attribute_id].push(n),t),{});return r.createElement(r.Fragment,null,r.createElement("form",{className:"flex flex-col md:flex-row gap-6  mx-auto font-poppins bg-[#F1F1F1] w-full",style:{padding:"40px"}},r.createElement("section",{className:"flex flex-col gap-4 md:basis-3/12 bg-white p-6 rounded-lg h-max md:sticky top-2"},r.createElement(R,{setFilter:h,filter:e,minPrice:m??0,maxPrice:d??0,categories:y,tags:P,attribute_values:Object.values(w),selected_category:p,tag_id:f})),r.createElement("section",{className:"flex flex-col gap-6 md:basis-9/12"},r.createElement("div",{className:"w-full bg-white rounded-lg font-medium flex flex-row justify-between items-center px-2 py-3"},r.createElement("div",null,r.createElement("span",{className:"font-normal text-[17px] text-[#666666] ml-3"},"Mostrando ",(c-1)*12+1," - ",c*12>u?u:c*12," de ",u," resultados"))),r.createElement("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 xl:grid-cols-4 gap-4 pr-4"},F.map((t,n)=>r.createElement(j,{key:`product-${t.id}`,item:t,bgcolor:"bg-white"}))),r.createElement("div",{className:"w-full font-medium flex flex-row justify-center items-center"},r.createElement(O,{current:c,setCurrent:x,pages:Math.ceil(u/12)})))))};N((m,d)=>{S(m).render(r.createElement(M,{...d}))});
